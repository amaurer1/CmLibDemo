//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CustomEdit.cpp
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// Copyright (c) 2023 Adrian Maurer. All rights reserved.
// Distributed under the MIT software license (http://www.opensource.org/licenses/mit-license.php).
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#include "pch.h"
#include "framework.h"
#include "CustomEdit.h"
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
#ifdef _DEBUG
#define new DEBUG_NEW
#endif
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CCustomEdit
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CCustomEdit - MESSAGE MAP FUNCTIONS
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BEGIN_MESSAGE_MAP(CCustomEdit, CEdit)
	ON_WM_KEYDOWN()
	ON_WM_CHAR()
	ON_WM_CONTEXTMENU()
END_MESSAGE_MAP()
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CCustomEdit::OnKeyDown(UINT nChar, UINT nRepCnt, UINT nFlags)
{
	if (!isLocked())
	{
		if (nChar == 'A' && HIWORD(::GetKeyState(VK_CONTROL))) SetSel(0, -1);
		else CEdit::OnKeyDown(nChar, nRepCnt, nFlags);
	}
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CCustomEdit::OnChar(UINT nChar, UINT nRepCnt, UINT nFlags)
{
	if (!isLocked()) CEdit::OnChar(nChar, nRepCnt, nFlags);
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CCustomEdit::OnContextMenu(CWnd* pWnd, CPoint pnt)
{
	if (!isLocked()) CEdit::OnContextMenu(pWnd, pnt);
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CTextEdit
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CTextEdit - ELEMENT FUNCTIONS
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
void CTextEdit::setText(const std::wstring& t, const bool che)
{
	if (!che)
	{
		changeHandlerEnabled = false;
		SetWindowTextW(t.data());
		changeHandlerEnabled = true;
	}
	else
	{
		SetWindowTextW(t.data());
	}
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
std::wstring CTextEdit::getText() const
{
	CString t;
	GetWindowTextW(t);
	return t.GetString();
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// CTextEdit - MESSAGE MAP FUNCTIONS
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BEGIN_MESSAGE_MAP(CTextEdit, CCustomEdit)
	ON_CONTROL_REFLECT_EX(EN_CHANGE, &CTextEdit::OnEnChange)
END_MESSAGE_MAP()
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
BOOL CTextEdit::OnEnChange()
{
	return !changeHandlerEnabled;
}
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
